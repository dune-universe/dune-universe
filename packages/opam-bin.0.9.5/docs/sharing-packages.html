

<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Sharing Packages &mdash; opam-bin z-2020-08-29-use-drom
 (d97e44e
) (2020/08/31 06:55) documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/fixes.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Commands" href="commands.html" />
    <link rel="prev" title="Local Usage" href="local-usage.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> opam-bin
          

          
          </a>

          
            
            
              <div class="version">
                z-2020-08-29-use-drom
 (d97e44e
)
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-concepts.html">Basic Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="local-usage.html">Local Usage</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Sharing Packages</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#private-sharing">Private Sharing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#public-sharing">Public Sharing</a></li>
<li class="toctree-l2"><a class="reference internal" href="#using-a-binary-repository-only">Using a Binary Repository Only</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="commands.html">Commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="repositories.html">Contributed Binary Repositories</a></li>
<li class="toctree-l1"><a class="reference internal" href="f-a-q.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-and-thanks.html">About, Thanks and Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">Copyright and License</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/ocamlpro/opam-bin">Devel and Issues on Github</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">opam-bin</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Sharing Packages</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/sharing-packages.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="sharing-packages">
<h1>Sharing Packages<a class="headerlink" href="#sharing-packages" title="Permalink to this headline">¶</a></h1>
<div class="section" id="private-sharing">
<h2>Private Sharing<a class="headerlink" href="#private-sharing" title="Permalink to this headline">¶</a></h2>
<p><code class="code docutils literal notranslate"><span class="pre">opam-bin</span></code> provides a simple way to share the binary packages
with other users and computers: it automatically creates an
<code class="code docutils literal notranslate"><span class="pre">opam</span></code> repository with the binary packages that are created. The
repository is located in <code class="code docutils literal notranslate"><span class="pre">~/.opam/plugins/opam-bin/store/repo</span></code>
and the corresponding archives are in
<code class="code docutils literal notranslate"><span class="pre">~/.opam/plugins/opam-bin/store/archives</span></code>.</p>
<p>By sharing the directory <code class="code docutils literal notranslate"><span class="pre">~/.opam/plugins/opam-bin/store/</span></code> with other
computers, you can simply reuse your binary packages. Here is such an
example session:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">clean</span>
<span class="n">opam</span> <span class="n">switch</span> <span class="n">create</span> <span class="mi">4</span><span class="o">.</span><span class="mi">07</span><span class="o">.</span><span class="mi">1</span>
<span class="n">opam</span> <span class="n">install</span> <span class="n">alt</span><span class="o">-</span><span class="n">ergo</span> <span class="o">-</span><span class="n">y</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">auv</span> <span class="o">--</span><span class="n">delete</span> <span class="o">~/.</span><span class="n">opam</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span><span class="o">/</span><span class="n">store</span> <span class="n">other</span><span class="o">-</span><span class="n">computer</span><span class="o">:/</span><span class="n">tmp</span><span class="o">/</span>
<span class="n">rsync</span> <span class="o">-</span><span class="n">auv</span> <span class="o">--</span><span class="n">delete</span> <span class="o">~/.</span><span class="n">opam</span><span class="o">/</span><span class="n">plugins</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span><span class="o">/</span><span class="n">cache</span> <span class="n">other</span><span class="o">-</span><span class="n">computer</span><span class="o">:/</span><span class="n">tmp</span><span class="o">/</span>
<span class="n">ssh</span> <span class="n">other</span><span class="o">-</span><span class="n">computer</span>
<span class="o">$</span> <span class="n">opam</span> <span class="n">remote</span> <span class="n">set</span><span class="o">-</span><span class="n">url</span> <span class="n">default</span> <span class="o">--</span><span class="n">all</span> <span class="o">--</span><span class="n">set</span><span class="o">-</span><span class="n">default</span> <span class="n">file</span><span class="o">:///</span><span class="n">tmp</span><span class="o">/</span><span class="n">store</span><span class="o">/</span><span class="n">repo</span>
<span class="o">$</span> <span class="n">opam</span> <span class="n">switch</span> <span class="n">create</span> <span class="o">--</span><span class="n">empty</span>
<span class="o">$</span> <span class="n">opam</span> <span class="n">install</span> <span class="n">alt</span><span class="o">-</span><span class="n">ergo</span><span class="o">+</span><span class="n">bin</span>
</pre></div>
</div>
<p>Note that we also add to share <code class="code docutils literal notranslate"><span class="pre">~/.opam/plugins/opam-bin/cache</span></code> on the
other computer, because without specific configuration, the <code class="code docutils literal notranslate"><span class="pre">url</span>
<span class="pre">{</span> <span class="pre">src:</span> <span class="pre">}</span></code> field in generated <code class="code docutils literal notranslate"><span class="pre">opam</span></code> files will not provide the
correct path to the archive. Fortunately, <code class="code docutils literal notranslate"><span class="pre">opam</span></code> is able to use
the cache to find the archives.</p>
</div>
<div class="section" id="public-sharing">
<h2>Public Sharing<a class="headerlink" href="#public-sharing" title="Permalink to this headline">¶</a></h2>
<p>If you want to share your binary packages on a public repository, it
requires almost no additional work: you only need to specify the URL
of your web-server in an option:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">config</span> <span class="o">--</span><span class="n">base</span><span class="o">-</span><span class="n">url</span> <span class="n">http</span><span class="o">://</span><span class="n">my</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span>
</pre></div>
</div>
<p>This command will not only change the configuration for newly created
packages, but also modify already generated binary packages to use
this URL for the <code class="code docutils literal notranslate"><span class="pre">url</span> <span class="pre">{</span> <span class="pre">src:</span> <span class="pre">}</span></code> field.</p>
<p>After this command, the repository is expected to be copied in
<code class="code docutils literal notranslate"><span class="pre">http://my.server.com/opam-bin/repo</span></code>, while archives are
expected to be available in
<code class="code docutils literal notranslate"><span class="pre">http://my.server.com/opam-bin/archives</span></code>.</p>
<p><code class="code docutils literal notranslate"><span class="pre">opam-bin</span></code> also provides a simple way to copy the repository on
the remote server. You first need to specify where the files should be
copied, and then use the <code class="code docutils literal notranslate"><span class="pre">opam-bin</span> <span class="pre">push</span></code> command:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">config</span> <span class="o">--</span><span class="n">rsync</span><span class="o">-</span><span class="n">url</span> <span class="n">my</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">:/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span>
<span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">push</span>
</pre></div>
</div>
<p>By default, this <code class="code docutils literal notranslate"><span class="pre">opam-bin</span> <span class="pre">push</span></code> will delete all upstream
packages that are not locally present. It will also generate in the
repository a file <code class="code docutils literal notranslate"><span class="pre">index.tar.gz</span></code> for <code class="code docutils literal notranslate"><span class="pre">opam</span></code>, and a file
<code class="code docutils literal notranslate"><span class="pre">index.html</span></code> listing all available packages.</p>
<p>If you don’t want this behavior, i.e. you only want to merge new
packages, you should use the <code class="code docutils literal notranslate"><span class="pre">--merge</span></code> option, you will also
need to recreate the file <code class="code docutils literal notranslate"><span class="pre">index.tar.gz</span></code> upstream:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">config</span> <span class="o">--</span><span class="n">rsync</span><span class="o">-</span><span class="n">url</span> <span class="n">my</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">:/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span>
<span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">push</span> <span class="o">--</span><span class="n">merge</span>
<span class="n">ssh</span> <span class="n">my</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">com</span>
<span class="o">$</span> <span class="n">cd</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span><span class="o">/</span><span class="n">repo</span>
<span class="o">$</span> <span class="n">opam</span> <span class="n">admin</span> <span class="n">index</span>
</pre></div>
</div>
<p>Yet, most of the time, you will want to build your packages on top of
former binary packages, so you may want to first download your
upstream repo locally, so that you will be able to avoid the
<code class="code docutils literal notranslate"><span class="pre">--merge</span></code> option. For that, you can use <code class="code docutils literal notranslate"><span class="pre">opam-bin</span>
<span class="pre">pull</span></code>. For example, if you want to add a binary package for
<code class="code docutils literal notranslate"><span class="pre">alt-ergo</span></code> and its dependencies:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">config</span> <span class="o">--</span><span class="n">rsync</span><span class="o">-</span><span class="n">url</span> <span class="n">my</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">com</span><span class="o">:/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span>
<span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">pull</span>
<span class="n">opam</span> <span class="n">install</span> <span class="n">alt</span><span class="o">-</span><span class="n">ergo</span> <span class="o">-</span><span class="n">y</span>
<span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">push</span>
</pre></div>
</div>
<p>It is possible to customize the header and trailer of the generated
<code class="code docutils literal notranslate"><span class="pre">index.html</span></code> file by defining the files
<code class="code docutils literal notranslate"><span class="pre">~/.opam/plugins/opam-bin/header.html</span></code> and
<code class="code docutils literal notranslate"><span class="pre">~/.opam/plugins/opam-bin/trailer.html</span></code>.  To test the impact of
changing these files, you can use:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span> <span class="n">push</span> <span class="o">--</span><span class="n">local</span><span class="o">-</span><span class="n">only</span>
</pre></div>
</div>
<p>to generate a new
<code class="code docutils literal notranslate"><span class="pre">~/.opam/plugins/opam-bin/store/repo/index.html</span></code> file and check
the result.</p>
</div>
<div class="section" id="using-a-binary-repository-only">
<h2>Using a Binary Repository Only<a class="headerlink" href="#using-a-binary-repository-only" title="Permalink to this headline">¶</a></h2>
<p>Once a repository with binary packages has been published,
<code class="code docutils literal notranslate"><span class="pre">opam-bin</span></code> is not needed to use it.</p>
<p>For example:</p>
<div class="highlight-ocaml notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="nc">OPAMROOT</span><span class="o">=$</span><span class="nc">HOME</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">root</span>
<span class="n">opam</span> <span class="n">init</span> <span class="o">--</span><span class="n">bare</span> <span class="o">-</span><span class="n">n</span> <span class="n">https</span><span class="o">://</span><span class="n">www</span><span class="o">.</span><span class="n">origin</span><span class="o">-</span><span class="n">labs</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">opam</span><span class="o">-</span><span class="n">bin</span><span class="o">/</span><span class="n">debian10</span><span class="o">.</span><span class="mi">4</span><span class="o">-</span><span class="n">amd64</span><span class="o">/</span><span class="mi">4</span><span class="o">.</span><span class="mi">10</span><span class="o">.</span><span class="mi">0</span>
<span class="n">opam</span> <span class="n">switch</span> <span class="n">create</span> <span class="n">alt</span><span class="o">-</span><span class="n">ergo</span> <span class="o">--</span><span class="n">empty</span>
<span class="n">opam</span> <span class="n">install</span> <span class="n">alt</span><span class="o">-</span><span class="n">ergo</span> <span class="o">-</span><span class="n">y</span>
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="commands.html" class="btn btn-neutral float-right" title="Commands" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="local-usage.html" class="btn btn-neutral float-left" title="Local Usage" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, OCamlPro &amp; Origin Labs SAS. &lt;contact@ocamlpro.com&gt;

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>